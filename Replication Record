 -- RETURNS LIST OF REPLICATION RECORD FOR CURRENT DATE AND TIME
 
 SELECT "ST_DATABASEINFO"."DB_ReplSendSeq" AS HUB_SEND_SEQUENCE
	, "ST_DATABASEINFO"."DB_ReplSendDate" AS HUB_SEND_DATE
	, "ST_DATABASEINFO"."DB_ReplRecSeq" AS HUB_RECEIVE_SEQUENCFE
	, "ST_DATABASEINFO"."DB_ReplRecDate" AS HUB_RECEIVE_DATE
	, "ST_PLANT"."Plant_Name" AS VESSEL
	, (SELECT TOP(1) DB_REPLRECSEQ FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC) AS VESSEL_RECEIVE_SEQUENCE
	, (SELECT TOP(1) DB_REPLRECDATE FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC) AS VESSEL_RECEIVE_DATE
	, (SELECT TOP(1) DB_REPLSENDSEQ FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC) AS VESSEL_SEND_SEQUENCE
	, (SELECT TOP(1) DB_REPLSENDDATE FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC) AS VESSEL_SEND_DATE
	, (SELECT TOP(1) DBINFOLOG_DATE FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC) AS RECORD_DATE
 FROM   (ST_DATABASEINFO INNER JOIN ST_PLANT ON ST_DATABASEINFO.DB_Id = ST_PLANT.DB_Id) 
 WHERE  ST_DATABASEINFO.DB_Active =-1 
	AND ST_PLANT.Rec_Deleted =0 
 ORDER BY ST_PLANT.Plant_Name ASC, RECORD_DATE DESC


-- MODIFIED QUERY FOR POWER BI REPORTING. SEQUENCE NO. AND DATE IS CONCATENATED

 SELECT "ST_PLANT"."Plant_Name" AS VESSEL
	, CONVERT(varChar, (SELECT TOP(1) DB_REPLSENDSEQ FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC)) + ' - ' +
	  CONVERT(varChar, (SELECT TOP(1) DB_REPLSENDDATE FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC)) AS VESSEL_SIDE_SENT
	, CONVERT(varChar, (SELECT TOP(1) DB_REPLRECSEQ FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC)) + ' - ' +
	  CONVERT(varChar, (SELECT TOP(1) DB_REPLRECDATE FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC)) AS VESSEL_SIDE_RECEIVED
	, CONVERT(varChar, "ST_DATABASEINFO"."DB_ReplSendSeq") + ' - ' + CONVERT(varChar, "ST_DATABASEINFO"."DB_ReplSendDate") AS HUB_SIDE_SENT
	, CONVERT(varChar, "ST_DATABASEINFO"."DB_ReplRecSeq") + ' - ' + CONVERT(varChar, "ST_DATABASEINFO"."DB_ReplRecDate") AS HUB_SIDE_RECEIVED
	, (SELECT TOP(1) DBINFOLOG_DATE FROM ST_DATABASEINFOLOG WHERE DB_ID = ST_PLANT.DB_ID AND REC_DELETED = 0 ORDER BY DBINFOLOG_DATE DESC) AS RECORD_DATE
 FROM   (ST_DATABASEINFO INNER JOIN ST_PLANT ON ST_DATABASEINFO.DB_Id = ST_PLANT.DB_Id) 
 WHERE  ST_DATABASEINFO.DB_Active =-1 
	AND ST_PLANT.Rec_Deleted =0 
 ORDER BY ST_PLANT.Plant_Name ASC, RECORD_DATE DESC
